#!/bin/sh

set -e

case "$1" in
  "--help"|"-h"|"")
    echo "Usage: $0 container-name image-name" >&2
    exit 1
    ;;
esac

image_name="$2"
container_name="$1"
container="/var/cookie-cutter/containers/$container_name"

trap "
  rm -rf --one-file-system '$container'
" INT TERM HUP EXIT

mkdir "$container" "$container/diff" "$container/filesystem" "$container/work"
echo "$image_name" > "$container/from"

my_dir="`dirname $0`"
"$my_dir"/cc-mount "$container_name" &&
  trap - INT TERM HUP EXIT
